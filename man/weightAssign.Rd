% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/instrinsicIsotopes.R
\name{weightAssign}
\alias{weightAssign}
\title{Calculate Weights for Isotope Assignments
weightAssign}
\usage{
weightAssign(knownLocs, isovalues, isoSTD, intercept, slope, odds = 0.67,
  relAbund, weightRange = c(-1, 1), sppShapefile = NULL,
  assignExtent = c(-179, -60, 15, 89), element = "Hydrogen",
  surface = FALSE, period = "Annual")
}
\arguments{
\item{knownLocs}{matrix of capture locations of the same length as \code{isovalues}}

\item{isovalues}{vector of tissue isotope values from known locations}

\item{isoSTD}{standard deviation from calibration}

\item{intercept}{intercept value from calibration}

\item{slope}{value from calibration}

\item{odds}{odds ratio to use to set likely and unlikely locations defaults to 0.67}

\item{relAbund}{raster layer of relative abundance that sums to 1.}

\item{weightRange}{vector of length 2 within minimum and maximum values to weight isotope and relative abundance.
Default = c(-1,1)}

\item{sppShapefile}{SpatialPolygon layer defining species range. Assignments are restricted to these
areas.}

\item{assignExtent}{definition for the extent of the assignment. Can be used in place of \code{sppShapefile} to
limit assignment. Input should follow \code{c(xmin,xmax,ymin,ymax)} in degrees longitude and latitude.}

\item{element}{The elemental isotope of interest. Currently the only
elements that are implemented are 'Hydrogen' (default) and 'Oxygen'}

\item{surface}{if "TRUE" returns surface water values. Defaults is 'FALSE'
which returns the isotopes ratio found in precipitation.}

\item{period}{The time period of interest. If 'Annual' returns a raster
of mean annual values in precipitation for the \code{element}. If
'GrowingSeason' returns growing season values in precipitation for
 \code{element} of interest.}
}
\value{
returns an \code{weightAssign} object containing the following:
  \describe{
   \item{\code{top}}{data.frame with the optimal weightings}
   \item{\code{frontier}}{data.frame with values that fall along the Pareto frontier}
   \item{\code{performance}}{data.frame with error rate and assignment area for each weight combination}
}
}
\description{
The primary purpose of this function is to determine whether weighting likelihood based isotope assignments
and prior information, such as relative abundance can improve the model performance compared to the
isotope-only model. To do this, we raise the likelihood and prior values to powers from 0.1
to 10 and measure model performance using the assignment error rate and assignment area. Weights < 1 flatten
the likelihood/prior distributions (giving relatively more weight to smaller values) and weights > 1
sharpen the distributions (giving relatively less weight to smaller values. The \code{weightAssign} function
generates origin assignments using stable-hydrogen isotopes in tissue. If first generates
a probability surface of origin assignment from a vector of stable-isotope values for each animal/sample
captured at a known location. Probabilistic assignments are constructed by first converting observed
stable-isotope ratios (isoscape) in either precipitation or surface waters into a 'tissuescape' using
a user-provided intercept, slope and standard deviation. See
\href{http://journals.plos.org/plosone/article?id=10.1371/journal.pone.0035137}{Hobson et. al. (2012)}.
}
\details{
See \href{https://onlinelibrary.wiley.com/doi/10.1002/ece3.2605}{Rushing et al. (2017)} for more information.
}
\examples{
\dontrun{
OVENdist <- raster::shapefile("data-raw/Spatial_Layers/OVENdist.shp")
OVENdist <- OVENdist[OVENdist$ORIGIN==2,] # only breeding
raster::crs(OVENdist) <- "+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0"

OVENvals <- read.csv("data-raw/deltaDvalues.csv")

HBEFbirds <- OVENvals[grep("NH",OVENvals[,1]),]
knownLocs <- cbind(rep(-73,nrow(HBEFbirds)),rep(43,nrow(HBEFbirds)))

utils::download.file("https://www.mbr-pwrc.usgs.gov/bbs/ra15/ra06740.zip", destfile = "oven.zip")
utils::unzip("oven.zip")
oven_dist <- raster::shapefile("ra06740.shp")

# Empty raster with the same dimensions as isoscape and Ovenbird distribution
r <- raster::raster(nrow = 83, ncol = 217, res = c(0.333333, 0.333333),
                    xmn = -125.0001, xmx = -52.66679, ymn = 33.33321, ymx = 60.99985,
                    crs = MigConnectivity::projections$WGS84)

relativeAbund <- raster::rasterize(sp::spTransform(oven_dist, sp::CRS(r@crs@projargs)),r)
relativeAbund <- relativeAbund /raster::cellStats(relativeAbund ,sum)

                 isovalues = HBEFbirds[,2],
                 isoSTD = 12,
                 intercept = -10,
                 slope = 0.8,
                 odds = 0.67,
                 relAbund = relativeAbund,
                 weightRange = c(-1,1),
                 sppShapefile = OVENdist,
                 assignExtent = c(-179,-60,15,89),
                 element = "Hydrogen",
                 surface = FALSE,
                 period = "Annual")
}
}
